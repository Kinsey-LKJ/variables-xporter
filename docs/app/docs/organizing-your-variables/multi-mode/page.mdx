import { Callout } from 'nextra/components'

# 多模式

用单一出口原则来组织多模式变量


## 传统的多模式变量组织方式

以明暗主题为例，传统的做法是在一个集合中为每个变量设置 light 和 dark 两个模式：

```
┌──────────────────────┬──────────┬──────────┐
│ Collection           │ light    │ dark     │
├──────────────────────┼──────────┼──────────┤
│ colors/primary       │ #E55517  │ #EE6D21  │
│ colors/background    │ #FFFFFF  │ #1F2937  │
│ colors/text         │ #111827  │ #F9FAFB  │
│ font/size/base      │ 16px     │ 16px     │
│ font/size/lg        │ 18px     │ 18px     │
│ font/size/xl        │ 20px     │ 20px     │
│ font/weight/normal  │ 400      │ 400      │
│ font/weight/medium  │ 500      │ 500      │
│ font/weight/bold    │ 700      │ 700      │
│ spacing/base        │ 16px     │ 16px     │
│ spacing/loose       │ 24px     │ 24px     │
│ spacing/tight       │ 8px      │ 8px      │
└──────────────────────┴──────────┴──────────┘
```


这种方法在只有明暗主题切换时看起来很直观，但存在以下问题：

1. **变量和模式耦合**
   - 每个变量都必须设置所有模式
   - 即使某些变量不需要在不同模式下变化，例如字体大小、字重和间距

2. **难以维护**
   - 在有多个维度的模式下，所有的模式变化都在一个地方
   - 当需要添加新的模式维度时（如品牌主题），会导致模式组合的指数增长

## 单一出口原则

让我们看看如何用单一出口原则来组织明暗主题变量。

### 1. Design Tokens 集合（主集合）

```
┌────────────────────────┬────────────────────────┐
│                        │                        │
│ Design Tokens          │         default        │
│                        │                        │
├────────────────────────┼────────────────────────┤
│                        │                        │
│ colors/primary/DEFAULT │ colors/primary/DEFAULT │
│ colors/zhiyun/600     │ #EE6D21               │
│ colors/zhiyun/500     │ #E55517               │
│ colors/fiveray/600    │ #DA5959               │
│ colors/fiveray/500    │ #C03939               │
│ ...                   │ ...                   │
│                       │                    │
└────────────────────────┴────────────────────────┘
```

此集合是主集合，存放所有变量，只有一个默认模式，那么该如何实现明暗主题切换呢？让我们借助另一个集合来实现。

### 2. Theme Modes 集合

```
┌────────────────────────┬──────────────────────┬─────────────────────┐
│                        │                      │                     │
│ Theme Modes            │         light        │         dark        │
│                        │                      │                     │
├────────────────────────┼──────────────────────┼─────────────────────┤
│                        │                      │                     │
│ colors/primary/DEFAULT │ colors/primary/light │ colors/primary/dark │
│                        │                      │                     │
└────────────────────────┴──────────────────────┴─────────────────────┘
```
此集合专门存放明暗主题相关的变量，我们只需让主集合里的变量引用此集合里的变量，即可实现明暗主题切换。

### 变量引用链

```
                ┌────────────────────────┬────────────────────────┐                     
                │                        │                        │                     
                │ Design Tokens          │         defalut        │                     
                │                        │                        │                     
                ├────────────────────────┼────────────────────────┤                     
                │                        │                        │                     
                │ colors/primary/DEFAULT │ colors/primary/DEFAULT─┼───────┐             
                │                        │                        │       │             
┌──────────────►│ colors/zhiyun/600      │ #E55517                │       │             
│               │                        │                        │       │             
├──────────────►│ colors/zhiyun/500      │ #C03939                │       │             
│               │                        │                        │       │             
│               │ ...                    │ ...                    │       │             
│               │                        │                        │       │             
│               └────────────────────────┴────────────────────────┘       │             
│                                                                         │             
│                                                                         │             
│    ┌────────────────────────────────────────────────────────────────────┘             
│    │                                                                                  
│    │                                                                                  
│    │           ┌────────────────────────┬──────────────────────┬─────────────────────┐
│    │           │                        │                      │                     │
│    │           │ Theme Modes            │         light        │         dark        │
│    │           │                        │                      │                     │
│    │           ├────────────────────────┼──────────────────────┼─────────────────────┤
│    │           │                        │                      │                     │
│    └──────────►│ colors/primary/DEFAULT │ colors/zhiyun/600──┐ │ colors/zhiyun/500─┐ │
│                │                        │                    │ │                   │ │
│                │ ...                    │ ...                │ │ ...               │ │
│                │                        │                    │ │                   │ │
│                └────────────────────────┴────────────────────┼─┴───────────────────┼─┘
│                                                              │                     │  
│                                                              │                     │  
└────────────────────────────────────────────���─────────────────┴─────────────────────┘  
```

以 `colors/primary/DEFAULT` 为例：
这个变量在 `Design Tokens` 集合里的值引用了 `Theme Modes` 集合里的 `colors/primary/DEFAULT` 这个同名变量，`Theme Modes` 集合里的这个变量在不同模式下有不同的值，这就实现了明暗主题切换，但是在 `Theme Modes` 集合里
只需关心在不同明暗主题下会发生变化的变量，其他与明暗主题无关的变量，在 `Theme Modes` 集合里无需出现。


在 Figma 中使用 `colors/primary/DEFAULT` 变量时，只需在 Design Tokens 集合中选择 `colors/primary/DEFAULT`，无需在 Theme Modes 集合中寻找，**使用者无需关心变量的嵌套引用关系，他们只需关心唯一的出口，也就是 `Design Tokens` 集合，**
**在使用 Variables Xporter 插件时，也只需导出 `Design Tokens` 集合的变量，插件会自动跨集合追溯每一个变量到最终值。这就是单一出口原则。**

