import { Callout } from 'nextra/components'

# 多模式变量管理

让我们深入探讨如何使用单一出口原则（Single Source of Truth）来优雅地组织和管理多模式变量。这种方法不仅能让你的设计系统更加灵活，还能大大提升维护效率。

## 传统的多模式变量组织方式

让我们先来看看传统的多模式变量组织方式。以明暗主题（Light/Dark Mode）为例，传统做法是在同一个集合中为每个变量设置不同的模式值：

```
┌──────────────────────┬──────────┬──────────┐
│ Collection           │ light    │ dark     │
├──────────────────────┼──────────┼──────────┤
│ colors/primary       │ #E55517  │ #EE6D21  │
│ colors/background    │ #FFFFFF  │ #1F2937  │
│ colors/text         │ #111827  │ #F9FAFB  │
│ font/size/base      │ 16px     │ 16px     │
│ font/size/lg        │ 18px     │ 18px     │
│ font/size/xl        │ 20px     │ 20px     │
│ font/weight/normal  │ 400      │ 400      │
│ font/weight/medium  │ 500      │ 500      │
│ font/weight/bold    │ 700      │ 700      │
│ spacing/base        │ 16px     │ 16px     │
│ spacing/loose       │ 24px     │ 24px     │
│ spacing/tight       │ 8px      │ 8px      │
└──────────────────────┴──────────┴──────────┘
```


这种方法在只处理明暗主题切换时看起来很直观，但随着项目的发展会遇到以下挑战：

1. **变量和模式强耦合**
   - 每个变量都必须为所有模式设置值
   - 即使某些变量（如字体大小、字重和间距）在不同模式下保持不变，也需要重复设置

2. **难以扩展和维护**
   - 所有模式的变化都集中在一个地方，使得变量管理变得复杂
   - 当需要添加新的模式维度（如品牌主题）时，模式组合会呈指数级增长

## 单一出口原则

让我们来看看如何运用单一出口原则来优雅地组织明暗主题变量，这种方法能够让我们的变量管理更加清晰和可维护。

### 1. Design Tokens 集合（主集合）

首先，我们创建一个主集合来存放所有设计变量：

```
┌────────────────────────┬────────────────────────┐
│                        │                        │
│ Design Tokens          │         default        │
│                        │                        │
├────────────────────────┼────────────────────────┤
│                        │                        │
│ colors/primary/DEFAULT │ colors/primary/DEFAULT │
│ colors/zhiyun/600     │ #EE6D21               │
│ colors/zhiyun/500     │ #E55517               │
│ colors/fiveray/600    │ #DA5959               │
│ colors/fiveray/500    │ #C03939               │
│ ...                   │ ...                   │
│                       │                    │
└────────────────────────┴────────────────────────┘
```

这个主集合只包含一个默认模式，它是所有变量的统一入口。那么，如何实现明暗主题的切换呢？这就需要借助另一个专门的主题模式集合。

### 2. Theme Modes 集合

接下来，我们创建一个专门用于管理主题模式的集合：

```
┌────────────────────────┬──────────────────────┬─────────────────────┐
│                        │                      │                     │
│ Theme Modes            │         light        │         dark        │
│                        │                      │                     │
├────────────────────────┼──────────────────────┼─────────────────────┤
│                        │                      │                     │
│ colors/primary/DEFAULT │ colors/primary/light │ colors/primary/dark │
│                        │                      │                     │
└────────────────────────┴──────────────────────┴─────────────────────┘
```

这个集合专门负责存放需要在明暗主题间切换的变量。通过让主集合中的变量引用此集合中的对应变量，我们就能实现优雅的主题切换。

### 变量引用链

```
                ┌────────────────────────┬────────────────────────┐
                │                        │                        │
                │ Design Tokens          │         defalut        │
                │                        │                        │
                ├────────────────────────┼────────────────────────┤
                │                        │                        │
                │ colors/primary/DEFAULT │ colors/primary/DEFAULT─┼───────┐
                │                        │                        │       │
┌──────────────►│ colors/zhiyun/600      │ #E55517                │       │
│               │                        │                        │       │
├──────────────►│ colors/zhiyun/500      │ #C03939                │       │
│               │                        │                        │       │
│               │ ...                    │ ...                    │       │
│               │                        │                        │       │
│               └────────────────────────┴────────────────────────┘       │
│                                                                         │
│                                                                         │
│    ┌────────────────────────────────────────────────────────────────────┘
│    │
│    │
│    │           ┌────────────────────────┬──────────────────────┬─────────────────────┐
│    │           │                        │                      │                     │
│    │           │ Theme Modes            │         light        │         dark        │
│    │           │                        │                      │                     │
│    │           ├────────────────────────┼──────────────────────┼─────────────────────┤
│    │           │                        │                      │                     │
│    └──────────►│ colors/primary/DEFAULT │ colors/zhiyun/600──┐ │ colors/zhiyun/500─┐ │
│                │                        │                    │ │                   │ │
│                │ ...                    │ ...                │ │ ...               │ │
│                │                        │                    │ │                   │ │
│                └────────────────────────┴────────────────────┼─┴───────────────────┼─┘
│                                                              │                     │
│                                                              │                     │
└──────────────────────────────────────────────────────────────┴─────────────────────┘
```

让我们以 `colors/primary/DEFAULT` 为例来详细说明这个工作流程：

1. 在 `Design Tokens` 集合中，这个变量引用了 `Theme Modes` 集合中的同名变量
2. 在 `Theme Modes` 集合中，这个变量在不同模式下设置了不同的值，从而实现了主题切换
3. 重要的是，`Theme Modes` 集合只需包含那些在不同主题下需要变化的变量，其他保持不变的变量无需在此出现

<Callout type="info" emoji="💡">
**使用者视角：** 在 Figma 中，设计师只需从 Design Tokens 集合中选择所需的变量即可，无需关心背后的变量引用关系。这就是单一出口原则的优势 —— 提供一个统一的、清晰的接口。

**导出过程：** 使用 Variables Xporter 插件时，只需导出 Design Tokens 集合的变量。插件会自动追踪每个变量的引用链，确保获取最终的具体值。
</Callout>


## 处理复杂的多模式场景

让我们通过一些实际场景来深入理解如何使用变量追溯机制来处理复杂的多模式变量管理。

### 品牌主题组合

让我们看一个更复杂的场景，如何同时处理品牌和主题的组合：

```
                ┌────────────────────────┬────────────────────────┐
                │                        │                        │
                │ Design Tokens          │         default        │
                │                        │                        │
                ├────────────────────────┼────────────────────────┤
                │                        │                        │
                │ colors/primary/DEFAULT │ colors/primary/DEFAULT │ ──────┐
                │                        │                        │       │
┌──────────────►│ colors/zhiyun/600     │ #EE6D21               │       │
│               │                        │                        │       │
├──────────────►│ colors/zhiyun/500     │ #C03939               │       │
│               │                        │                        │       │
├──────────────►│ colors/fiveray/600    │ #DA5959               │       │
│               │                        │                        │       │
├──────────────►│ colors/fiveray/500    │ #E55517               │       │
│               │                        │                        │       │
│               │ ...                    │ ...                    │       │
│               │                        │                        │       │
│               └────────────────────────┴────────────────────────┘       │
│                                                                         │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────┘
│   │
│   │
│   │           ┌────────────────────────┬──────────────────────┬─────────────────────┐
│   │           │                        │                      │                     │
│   │           │ Theme Modes            │         light        │         dark        │
│   │           │                        │                      │                     │
│   │           ├────────────────────────┼──────────────────────┼─────────────────────┤
│   │           │                        │                      │                     │
│   └──────────►│ colors/primary/DEFAULT │ colors/primary/light │ colors/primary/dark │
│               │                        │                      │                     │
│               │ ...                    │ ...                  │ ...                 │
│               │                        │                      │                     │
│               └────────────────────────┴──────────────────────┴─────────────────────┘
│
│
│               ┌────────────────────────┬──────────────────────┬─────────────────────┐
│               │                        │                      │                     │
│               │ Brand Modes            │        zhiyun        │       fiveray       │
│               │                        │                      │                     │
│               ├────────────────────────┼──────────────────────┼─────────────────────┤
│               │                        │                      │                     │
│   ├──────────►│ colors/primary/light   │ colors/zhiyun/500   │ colors/fiveray/500  │
│   │           │                        │                      │                     │
│   └──────────►│ colors/primary/dark    │ colors/zhiyun/600   │ colors/fiveray/600  │
                │                        │                      │                     │
                │ ...                    │ ...                  │ ...                 │
                │                        │                      │                     │
                └────────────────────────┴──────────────────────┴─────────────────────┘
```

在这个结构中：
1. Design Tokens 集合作为单一出口，引用 Theme Modes 集合中的变量
2. Theme Modes 集合管理明暗主题的切换
3. Brand Modes 集合管理不同品牌的颜色变体

### 响应式设计模式

在响应式设计中，我们经常需要根据不同的屏幕尺寸调整设计变量。以下是一个结合响应式设计和主题模式的示例：

```
Design Tokens
└── spacing/container/DEFAULT ────────┐
                                     │
Responsive Modes                     │
└── spacing/container/DEFAULT ◄──────┘
    └── breakpoints
        ├── sm: 640px
        ├── md: 768px
        ├── lg: 1024px
        └── xl: 1280px
```

这种结构允许你：
1. 在主集合中统一管理容器宽度
2. 在响应式模式集合中定义不同断点的值
3. 通过变量引用保持整个系统的一致性

### 季节性主题管理

对于需要定期更新主题的应用，我们可以添加季节性主题层：

```
Design Tokens
└── colors/accent/DEFAULT ──────────┐
                                   │
Theme Modes                        │
└── colors/accent/DEFAULT ◄────────┘
    └── modes
        ├── spring: #91D5FF
        ├── summer: #FFD591
        ├── autumn: #FFA39E
        └── winter: #D3ADF7
```

这种结构使得：
1. 主题切换不影响基础设计系统
2. 季节性变化可以优雅地融入现有系统
3. 维护和更新变得简单直观

## 最佳实践与注意事项

1. **集合组织**
   - 设置一个主集合作为单一出口
   - 为每个变化维度（如主题、品牌、响应式）创建独立的集合
   - 在主集合中存储基础变量值

2. **变量引用**
   - 在主集合中创建统一的变量入口
   - 根据模式类型组织引用链
   - 确保引用关系清晰可追踪

3. **模式管理**
   - 按照变化维度划分模式
   - 只为需要变化的变量设置模式
   - 及时清理未使用的模式和变量

<Callout type="warning" emoji="⚠️">
虽然变量可以跨集合引用，但建议保持引用链的长度适中，过长的引用链可能会影响可维护性。建议不要超过 3-4 层的引用深度。
</Callout>

