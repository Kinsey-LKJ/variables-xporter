import { Callout } from 'nextra/components'

# 多模式变量管理

让我们深入探讨如何使用单一出口原则（Single Source of Truth）来优雅地组织和管理多模式变量。这种方法不仅能让你的设计系统更加灵活，还能大大提升维护效率。

## 传统的多模式变量组织方式

让我们先来看看传统的多模式变量组织方式。以明暗主题（Light/Dark Mode）为例，传统做法是在同一个集合中为每个变量设置不同的模式值：

```
┌──────────────────────┬──────────┬──────────┐
│ Collection           │ light    │ dark     │
├──────────────────────┼──────────┼──────────┤
│ colors/primary       │ #E55517  │ #EE6D21  │
│ colors/background    │ #FFFFFF  │ #1F2937  │
│ colors/text          │ #111827  │ #F9FAFB  │
│ font/size/base       │ 16px     │ 16px     │
│ font/size/lg         │ 18px     │ 18px     │
│ font/size/xl         │ 20px     │ 20px     │
│ font/weight/normal   │ 400      │ 400      │
│ font/weight/medium   │ 500      │ 500      │
│ font/weight/bold     │ 700      │ 700      │
│ spacing/base         │ 16px     │ 16px     │
│ spacing/loose        │ 24px     │ 24px     │
│ spacing/tight        │ 8px      │ 8px      │
└──────────────────────┴──────────┴──────────┘
```


这种方法在只处理明暗主题切换时看起来很直观，但随着项目的发展会遇到以下挑战：

1. **变量和模式强耦合**
   - 每个变量都必须为所有模式设置值
   - 即使某些变量（如字体大小、字重和间距）在不同模式下保持不变，也需要重复设置

2. **难以扩展和维护**
   - 所有模式的变化都集中在一个地方，使得变量管理变得复杂
   - 当需要添加新的模式维度（如品牌主题）时，模式组合会呈指数级增长

## 单一出口原则 [#single-export-principle]

**单一出口原则是值一个变量系统中，所有的变量以一个集合作为唯一出口，这个集合只包含一个模式，并通过引用其他集合中的变量来实现多模式变量管理。** 让我们来看看如何运用单一出口原则来优雅地组织明暗主题变量，这种方法能够让我们的变量管理更加清晰和可维护。

### 1. Design Tokens 集合（主集合）

首先，我们创建一个主集合来存放所有设计变量：

```
┌────────────────────────┬────────────────────────┐
│                        │                        │
│ Design Tokens          │         default        │
│                        │                        │
├────────────────────────┼────────────────────────┤
│                        │                        │
│ colors/primary/DEFAULT │ colors/primary/DEFAULT │
│ colors/zhiyun/600      │ #EE6D21                │
│ colors/zhiyun/500      │ #E55517                │
│ colors/fiveray/600     │ #DA5959                │
│ colors/fiveray/500     │ #C03939                │
│ ...                    │ ...                    │
│                        │                        │ 
└────────────────────────┴────────────────────────┘
```

这个主集合只包含一个默认模式，它是所有变量的统一入口。那么，如何实现明暗主题的切换呢？这就需要借助另一个专门的主题模式集合。

### 2. Theme Modes 集合

接下来，我们创建一个专门用于管理主题模式的集合：

```
┌────────────────────────┬──────────────────────┬─────────────────────┐
│                        │                      │                     │
│ Theme Modes            │         light        │         dark        │
│                        │                      │                     │
├────────────────────────┼──────────────────────┼─────────────────────┤
│                        │                      │                     │
│ colors/primary/DEFAULT │ colors/primary/light │ colors/primary/dark │
│                        │                      │                     │
└────────────────────────┴──────────────────────┴─────────────────────┘
```

这个集合专门负责存放需要在明暗主题间切换的变量。通过让主集合中的变量引用此集合中的对应变量，我们就能实现优雅的主题切换。

### 变量引用链

```
                ┌────────────────────────┬────────────────────────┐
                │                        │                        │
                │ Design Tokens          │         defalut        │
                │                        │                        │
                ├────────────────────────┼────────────────────────┤
                │                        │                        │
                │ colors/primary/DEFAULT │ colors/primary/DEFAULT─┼───────┐
                │                        │                        │       │
┌──────────────►│ colors/zhiyun/600      │ #E55517                │       │
│               │                        │                        │       │
├──────────────►│ colors/zhiyun/500      │ #C03939                │       │
│               │                        │                        │       │
│               │ ...                    │ ...                    │       │
│               │                        │                        │       │
│               └────────────────────────┴────────────────────────┘       │
│                                                                         │
│                                                                         │
│    ┌────────────────────────────────────────────────────────────────────┘
│    │
│    │
│    │           ┌────────────────────────┬──────────────────────┬─────────────────────┐
│    │           │                        │                      │                     │
│    │           │ Theme Modes            │         light        │         dark        │
│    │           │                        │                      │                     │
│    │           ├────────────────────────┼──────────────────────┼─────────────────────┤
│    │           │                        │                      │                     │
│    └──────────►│ colors/primary/DEFAULT │ colors/zhiyun/600──┐ │ colors/zhiyun/500─┐ │
│                │                        │                    │ │                   │ │
│                │ ...                    │ ...                │ │ ...               │ │
│                │                        │                    │ │                   │ │
│                └────────────────────────┴────────────────────┼─┴───────────────────┼─┘
│                                                              │                     │
│                                                              │                     │
└──────────────────────────────────────────────────────────────┴─────────────────────┘
```

让我们以 `colors/primary/DEFAULT` 为例来详细说明这个工作流程：

1. 在 `Design Tokens` 集合中，这个变量引用了 `Theme Modes` 集合中的同名变量
2. 在 `Theme Modes` 集合中，这个变量在不同模式下设置了不同的值，从而实现了主题切换
3. 重要的是，`Theme Modes` 集合只需包含那些在不同主题下需要变化的变量，其他保持不变的变量无需在此出现

<Callout type="info" emoji="💡">
**使用者视角：** 在 Figma 中，设计师只需从 Design Tokens 集合中选择所需的变量即可，无需关心背后的变量引用关系。这就是单一出口原则的优势 —— 提供一个统一的、清晰的接口。

**导出过程：** 使用 Variables Xporter 插件时，只需导出 Design Tokens 集合的变量。插件会自动追踪每个变量的引用链，确保获取最终的具体值。
</Callout>


## 创建复杂的多模式变量系统

使用单一出口原则能够创建复杂多维度的变量系统，例如包含明暗主题、品牌主题、响应式设计以及紧凑性模式等复合模式的变量系统，让我们一步步创建，并体会单一出口原则带来的好处。

### 从品牌主题组合开始

我们目前已经拥有了一个支持明暗主题的变量系统，现在我们希望在明暗主题的基础上，再加入品牌主题的变量系统。

```                                                                              
                ┌────────────────────────┬────────────────────────┐
                │                        │                        │
                │ Design Tokens          │         defalut        │
                │                        │                        │
                ├────────────────────────┼────────────────────────┤
                │                        │                        │
                │ colors/primary/DEFAULT │ colors/primary/DEFAULT─┼───────┐
                │                        │                        │       │
┌──────────────►│ colors/zhiyun/600      │ #E55517                │       │
│               │                        │                        │       │
├──────────────►│ colors/zhiyun/500      │ #C03939                │       │
│               │                        │                        │       │
│               │ ...                    │ ...                    │       │
│               │                        │                        │       │
│               └────────────────────────┴────────────────────────┘       │
│                                                                         │
│                                                                         │
│    ┌────────────────────────────────────────────────────────────────────┘
│    │
│    │
│    │           ┌────────────────────────┬──────────────────────┬─────────────────────┐
│    │           │                        │                      │                     │
│    │           │ Theme Modes            │         light        │         dark        │
│    │           │                        │                      │                     │
│    │           ├────────────────────────┼──────────────────────┼─────────────────────┤
│    │           │                        │                      │                     │
│    └──────────►│ colors/primary/DEFAULT │ colors/zhiyun/600──┐ │ colors/zhiyun/500─┐ │
│                │                        │                    │ │                   │ │
│                │ ...                    │ ...                │ │ ...               │ │
│                │                        │                    │ │                   │ │
│                └────────────────────────┴────────────────────┼─┴───────────────────┼─┘
│                                                              │                     │
│                                                              │                     │
└──────────────────────────────────────────────────────────────┴─────────────────────┘                                                                              
```

### 加入品牌主题模式
创建一个 `Brands Modes` 集合，用于管理品牌主题的变量，并创建两个不同的品牌模式（本例中是 `zhiyun` 和 `fiveray`），再创建两个变量 `colors/primary/light` 和 `colors/primary/dark` ，并在两个模式下设置不同的值（本例中引用了主集合 `Design Tokens` 中的相关颜色）。
```                                                                                                                                   
 ┌────────────────────────┬──────────────────────┬─────────────────────┐
 │                        │                      │                     │
 │ Brands Modes           │        zhiyun        │        fiveray      │
 │                        │                      │                     │
 ├────────────────────────┼──────────────────────┼─────────────────────┤
 │                        │                      │                     │
 │ colors/primary/light   │ colors/zhiyun/600    │ colors/fiveray/600  │
 │                        │                      │                     │
 │ colors/primary/dark    │ colors/zhiyun/600    │ colors/fiveray/50   │
 │                        │                      │                     │
 │ ...                    │ ...                  │ ...                 │
 │                        │                      │                     │
 └────────────────────────┴──────────────────────┴─────────────────────┘                                                                                                                               
```
接下来，我们让 `Theme Modes` 集合中的 `colors/primary/DEFAULT` 变量在 light 和 dark 模式下分别引用 `Brands Modes` 集合中的 `colors/primary/light` 和 `colors/primary/dark` 变量，并让 `Brands Modes` 集合中的 `colors/primary/light` 和 `colors/primary/dark` 变量分别引用 `Design Tokens` 集合中的 `colors/zhiyun/600` 和 `colors/fiveray/600` 变量。

```
                                                                                           
                                                                                           
                   ┌────────────────────────┬────────────────────────┐                     
                   │                        │                        │                     
                   │ Design Tokens          │         defalut        │                     
                   │                        │                        │                     
                   ├────────────────────────┼────────────────────────┤                     
                   │                        │                        │                     
                   │ colors/primary/DEFAULT │ colors/primary/DEFAULT │ ──────┐             
                   │                        │                        │       │             
   ┌──────────────►│ colors/zhiyun/600      │ #E55517                │       │             
   │               │                        │                        │       │             
   ├──────────────►│ colors/zhiyun/500      │ #C03939                │       │             
   │               │                        │                        │       │             
   ├──────────────►│ colors/fiveray/600     │ #EE6D21                │       │             
   │               │                        │                        │       │             
   ├──────────────►│ colors/fiveray/500     │ #DA5959                │       │             
   │               │                        │                        │       │             
   │               │ ...                    │ ...                    │       │             
   │               │                        │                        │       │             
   │               └────────────────────────┴────────────────────────┘       │             
   │                                                                         │             
   │                                                                         │             
   │   ┌─────────────────────────────────────────────────────────────────────┘             
   │   │                                                                                   
   │   │                                                                                   
   │   │           ┌────────────────────────┬──────────────────────┬─────────────────────┐ 
   │   │           │                        │                      │                     │ 
   │   │           │ Theme Modes            │         light        │         dark        │ 
   │   │           │                        │                      │                     │ 
   │   │           ├────────────────────────┼──────────────────────┼─────────────────────┤ 
   │   │           │                        │                      │                     │ 
   │   └──────────►│ colors/primary/DEFAULT │ colors/primary/light │ colors/primary/dark │ 
   │               │                        │                      │                     │ 
   │               │ ...                    │ ...      │           │ ...       │         │ 
   │               │                        │          │           │           │         │ 
   │               └────────────────────────┴──────────┼───────────┴───────────┼─────────┘ 
   │                                                   │                       │           
   │                                                   │                       │           
   │   ┌───────────────────────────────────────────────┴───────────────────────┘           
   │   │                                                                                   
   │   │                                                                                   
   │   │           ┌────────────────────────┬──────────────────────┬─────────────────────┐ 
   │   │           │                        │                      │                     │ 
   │   │           │ Brands Modes           │        zhiyun        │        fiveray      │ 
   │   │           │                        │                      │                     │ 
   │   │           ├────────────────────────┼──────────────────────┼─────────────────────┤ 
   │   │           │                        │                      │                     │ 
   │   ├──────────►│ colors/primary/light   │ colors/zhiyun/600──┐ │ colors/fiveray/600─┐│ 
   │   │           │                        │                    │ │                    ││ 
   │   └──────────►│ colors/primary/dark    │ colors/zhiyun/600──┤ │ colors/fiveray/50──┤│ 
   │               │                        │                    │ │                    ││ 
   │               │ ...                    │ ...                │ │ ...                ││ 
   │               │                        │                    │ │                    ││ 
   │               └────────────────────────┴────────────────────┼─┴────────────────────┼┘ 
   │                                                             │                      │  
   │                                                             │                      │  
   └─────────────────────────────────────────────────────────────┴──────────────────────┘  
                                                                                           
```
就是这样！你创建了一个包含明暗主题和品牌主题的多维变量系统，并且通过单一出口原则，让设计系统变得更加灵活和可维护。
整体的看变量的引用链会发现整体有些复杂，但是这样远比你在一个集合中管理所有变量要清晰和可维护，但我们还没有结束，让我们进一步扩展这个变量系统。


### 响应式设计模式
通常，字体尺寸变量会根据不同的屏幕尺寸进行调整，以 `font/hero/size` 这个变量为例，首先在 `Design Tokens` 集合中创建一个 `font/hero/size` 变量，并创建 `font/size/2xl` 和 `font/size/3xl` 两个变量。

```                                                                                                                                                                                         
    ┌────────────────────────┬────────────────────────┐
    │                        │                        │
    │ Design Tokens          │         defalut        │
    │                        │                        │
    ├────────────────────────┼────────────────────────┤
    │                        │                        │
    │ colors/primary/DEFAULT │ colors/primary/DEFAULT │
    │                        │                        │
    │ colors/zhiyun/600      │ #E55517                │
    │                        │                        │
    │ colors/zhiyun/500      │ #C03939                │
    │                        │                        │
    │ colors/fiveray/600     │ #EE6D21                │
    │                        │                        │
    │ colors/fiveray/500     │ #DA5959                │
    │                        │                        │
───►│ font/hero/size         │ font/size/2xl          │
    │                        │                        │
───►│ font/size/2xl          │ 24                     │
    │                        │                        │
───►│ font/size/3xl          │ 30                     │
    │                        │                        │
    │ ...                    │ ...                    │
    │                        │                        │
    └────────────────────────┴────────────────────────┘                 
```
创建一个 `Device Modes` 集合，用于管理响应式设计的变量，并创建一个 `font/hero/size` 变量，然后在不同设备尺寸下设置不同的值。
```
                                                                         
 ┌────────────────────────┬──────────────────────┬─────────────────────┐ 
 │                        │                      │                     │ 
 │ Device Modes           │        default       │    min-width:1024   │ 
 │                        │                      │                     │ 
 ├────────────────────────┼──────────────────────┼─────────────────────┤ 
 │                        │                      │                     │ 
 │ font/hero/size         │ font/size/2xl        │ font/size/3xl       │ 
 │                        │                      │                     │ 
 │ ...                    │ ...                  │ ...                 │ 
 │                        │                      │                     │ 
 └────────────────────────┴──────────────────────┴─────────────────────┘ 
```

现在，只需将 `Design Tokens` 集合中 `font/hero/size` 变量的值改为引用 `Device Modes` 集合中的 `font/hero/size` 变量即可！
```
                                                                              
       ┌────────────────────────┬────────────────────────┐                    
       │                        │                        │                    
       │ Design Tokens          │         defalut        │                    
       │                        │                        │                    
       ├────────────────────────┼────────────────────────┤                    
       │                        │                        │                    
       │ colors/primary/DEFAULT │ colors/primary/DEFAULT │                    
       │                        │                        │                    
       │ colors/zhiyun/600      │ #E55517                │                    
       │                        │                        │                    
       │ colors/zhiyun/500      │ #C03939                │                    
       │                        │                        │                    
       │ colors/fiveray/600     │ #EE6D21                │                    
       │                        │                        │                    
       │ colors/fiveray/500     │ #DA5959                │                    
       │                        │                        │                    
       │ font/hero/size         │ font/size/2xl          ├─────┐              
       │                        │                        │     │              
┌─────►│ font/size/2xl          │ 24                     │     │              
│      │                        │                        │     │              
├─────►│ font/size/3xl          │ 30                     │     │              
│      │                        │                        │     │              
│      │ ...                    │ ...                    │     │              
│      │                        │                        │     │              
│      └────────────────────────┴────────────────────────┘     │              
│                                                              │              
│                                                              │              
│  ┌───────────────────────────────────────────────────────────┘              
│  │                                                                          
│  │                                                                          
│  │   ┌────────────────────────┬──────────────────────┬─────────────────────┐
│  │   │                        │                      │                     │
│  │   │ Device Modes           │        default       │    min-width:1024   │
│  │   │                        │                      │                     │
│  │   ├────────────────────────┼──────────────────────┼─────────────────────┤
│  │   │                        │                      │                     │
│  └──►│ font/hero/size         │ font/size/2xl──┐     │ font/size/3xl──┐    │
│      │                        │                │     │                │    │
│      │ ...                    │ ...            │     │ ...            │    │
│      │                        │                │     │                │    │
│      └────────────────────────┴────────────────┼─────┴────────────────┼────┘
│                                                │                      │     
│                                                │                      │     
└────────────────────────────────────────────────┴──────────────────────┘     
```
我们省略了 `Theme Modes` 集合，因为它的内容与之前相同。这也是单一出口原则的优势，我们只需要关注需要在特定模式下改变的变量。


### 紧凑性模式
有的B端后台项目可能会有紧凑性模式，这种模式下，各种尺寸可能都会变小，比如字体、间距、容器宽度等。让我们进一步扩展我们的变量系统，加入紧凑性模式。
首先，在 `Design Tokens` 集合中创建一系列的 `spacing` 变量，用于管理间距、尺寸。为了方便演示，我们只创建了 `spacing/1` 这一个变量，在实际的项目中，你需要创建更多的变量，比如 `spacing/2`、`spacing/3` `spacing/4` 等等。查看[Spacing 变量的组织建议](/docs/organizing-your-variables/spacing)。
```                                         
                                                       
    ┌────────────────────────┬────────────────────────┐
    │                        │                        │
    │ Design Tokens          │         defalut        │
    │                        │                        │
    ├────────────────────────┼────────────────────────┤
    │                        │                        │
    │ colors/primary/DEFAULT │ colors/primary/DEFAULT │
    │                        │                        │
    │ colors/zhiyun/600      │ #E55517                │
    │                        │                        │
    │ colors/zhiyun/500      │ #C03939                │
    │                        │                        │
    │ colors/fiveray/600     │ #EE6D21                │
    │                        │                        │
    │ colors/fiveray/500     │ #DA5959                │
    │                        │                        │
    │ font/hero/size         │ font/size/2xl          │
    │                        │                        │
    │ font/size/2xl          │ 24                     │
    │                        │                        │
    │ font/size/3xl          │ 30                     │
    │                        │                        │
───►│ spacing/1              │ spacing/1              │
    │                        │                        │
    │ ...                    │ ...                    │
    │                        │                        │
    └────────────────────────┴────────────────────────┘
```
创建一个 `Density Modes` 集合，用于管理布局的松散性，并创建 `spacing/1`、`font/size/2xl` 和 `font/size/3xl` 变量，然后在不同松散程度下设置不同的值。
```                                                                                                                               
┌────────────────────────┬──────────────────────┬─────────────────────┐
│                        │                      │                     │
│ Density Modes          │        default       │       compact       │
│                        │                      │                     │
├────────────────────────┼──────────────────────┼─────────────────────┤
│                        │                      │                     │
│ spacing/1              │ 4                    │ 3                   │
│                        │                      │                     │
│ font/size/2xl          │ 24                   │ 22                  │
│                        │                      │                     │
│ font/size/3xl          │ 30                   │ 26                  │
│                        │                      │                     │
│ ...                    │ ...                  │ ...                 │
│                        │                      │                     │
└────────────────────────┴──────────────────────┴─────────────────────┘
```
将 `Design Tokens` 集合中的 `spacing/1`、`font/size/2xl` 和 `font/size/3xl` 变量值改为引用 `Density Modes` 集合中的 `spacing/1`、`font/size/2xl` 和 `font/size/3xl` 变量。
```                                                                                                                                      
    ┌────────────────────────┬────────────────────────┐                    
    │                        │                        │                    
    │ Design Tokens          │         defalut        │                    
    │                        │                        │                    
    ├────────────────────────┼────────────────────────┤                    
    │                        │                        │                    
    │ colors/primary/DEFAULT │ colors/primary/DEFAULT │                    
    │                        │                        │                    
    │ colors/zhiyun/600      │ #E55517                │                    
    │                        │                        │                    
    │ colors/zhiyun/500      │ #C03939                │                    
    │                        │                        │                    
    │ colors/fiveray/600     │ #EE6D21                │                    
    │                        │                        │                    
    │ colors/fiveray/500     │ #DA5959                │                    
    │                        │                        │                    
    │ font/hero/size         │ font/size/2xl          │                    
    │                        │                        │                    
    │ font/size/2xl          │ 24                     ├──────┐             
    │                        │                        │      │             
    │ font/size/3xl          │ 30                     ├──────┤             
    │                        │                        │      │             
    │ spacing/1              │ spacing/1              ├──────┤             
    │                        │                        │      │             
    │ ...                    │ ...                    │      │             
    │                        │                        │      │             
    └────────────────────────┴────────────────────────┘      │             
                                                             │             
                                                             │             
┌────────────────────────────────────────────────────────────┘             
│                                                                          
│                                                                          
│   ┌────────────────────────┬──────────────────────┬─────────────────────┐
│   │                        │                      │                     │
│   │ Density Modes          │        default       │       compact       │
│   │                        │                      │                     │
│   ├────────────────────────┼──────────────────────┼─────────────────────┤
│   │                        │                      │                     │
├──►│ spacing/1              │ 4                    │ 3                   │
│   │                        │                      │                     │
├──►│ font/size/2xl          │ 24                   │ 22                  │
│   │                        │                      │                     │
└──►│ font/size/3xl          │ 30                   │ 26                  │
    │                        │                      │                     │
    │ ...                    │ ...                  │ ...                 │
    │                        │                      │                     │
    └────────────────────────┴──────────────────────┴─────────────────────┘
```
恭喜你，你已经创建了一个十分强大的变量系统，并且易于扩展，一切的付出都是值得的，作为维护设计系统的设计师，你的变量可能会被其他设计师使用无数次，并在开发实现时扮演设计到开发的桥梁。
